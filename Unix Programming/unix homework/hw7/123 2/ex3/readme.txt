The way I implement semaphore is to implement three function: semaphore_p(), semaphore_v() and del_semvalue(), some of which is borrowed from book. semaphore_p() is used to lock critical region and semaphore_v() is used to unlock critical region. del_semvalue() is to delete semaphore. Customer is greedy, which continuously consume food. Producer continuously produces food. I maintain my stock count by using semaphore to lock the share memory in which the count variable is stored. So that will guarantee the correctness when there are producers and consumers.